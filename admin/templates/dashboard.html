<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin Dashboard - Does This Feel Right?</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
</head>

<body>
    <div class="app-container">
        <aside class="sidebar">
            <div class="logo">Admin</div>
            <nav>
                <a href="{{ url_for('dashboard') }}" class="active">Dashboard</a>
                <a href="{{ url_for('new_post') }}">New Post</a>
                <a href="#" onclick="publishSite()">ðŸš€ Publish Site</a>
            </nav>
            <div class="status-bar" id="status-bar">
                Connected to GitHub
            </div>
        </aside>

        <main class="content">
            <header class="top-bar">
                <h1>All Posts</h1>
                <div class="actions">
                    <button onclick="openAIModal()" class="btn-secondary" style="margin-right: 10px;">âœ¨ Write with
                        AI</button>
                    <a href="{{ url_for('new_post') }}" class="btn-primary">Write New</a>
                </div>
            </header>

            <div class="posts-list">
                {% for post in posts %}
                <a href="{{ url_for('edit', filename=post.filename) }}" class="post-item">
                    <div class="post-info">
                        <h3>{{ post.title }}</h3>
                        <span class="meta">{{ post.date }} â€¢ {{ post.category }}</span>
                    </div>
                    <div class="post-status">
                        <span class="badge published">Published</span>
                    </div>
                </a>
                {% endfor %}
            </div>
        </main>
    </div>

    <!-- AI Modal -->
    <div id="aiModal" class="modal"
        style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); justify-content: center; align-items: center;">
        <div class="modal-content"
            style="background: white; padding: 2rem; border-radius: 8px; width: 400px; max-width: 90%;">
            <h2>âœ¨ Write with AI</h2>
            <p>Enter a topic or prompt for your new blog post.</p>
            <textarea id="aiTopic" placeholder="e.g., The importance of slowing down..."
                style="width: 100%; height: 100px; margin: 1rem 0; padding: 0.5rem; border: 1px solid #ddd; border-radius: 4px;"></textarea>
            <div class="modal-actions" style="display: flex; justify-content: flex-end; gap: 10px;">
                <button onclick="closeAIModal()"
                    style="padding: 0.5rem 1rem; border: none; background: #eee; cursor: pointer; border-radius: 4px;">Cancel</button>
                <button onclick="generatePost()" id="generateBtn"
                    style="padding: 0.5rem 1rem; border: none; background: #000; color: white; cursor: pointer; border-radius: 4px;">Generate</button>
            </div>
        </div>
    </div>

    <script>
        function openAIModal() {
            document.getElementById('aiModal').style.display = 'flex';
        }

        function closeAIModal() {
            document.getElementById('aiModal').style.display = 'none';
        }

        async function generatePost() {
            const topic = document.getElementById('aiTopic').value;
            if (!topic) return;

            const btn = document.getElementById('generateBtn');
            const originalText = btn.textContent;
            btn.textContent = 'Generating...';
            btn.disabled = true;

            try {
                const response = await fetch('/generate-post', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ topic: topic })
                });
                const result = await response.json();

                if (result.status === 'success') {
                    window.location.href = '/edit/' + result.filename;
                } else {
                    alert('Error: ' + result.message);
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            } catch (e) {
                alert('Network Error');
                btn.textContent = originalText;
                btn.disabled = false;
            }
        }

        async function publishSite() {
            const statusBar = document.getElementById('status-bar');
            statusBar.textContent = 'Publishing...';
            statusBar.style.color = '#fbbf24';

            try {
                const response = await fetch('/publish', { method: 'POST' });
                const result = await response.json();

                if (result.status === 'success') {
                    statusBar.textContent = 'Published Successfully!';
                    statusBar.style.color = '#34d399';
                    setTimeout(() => {
                        statusBar.textContent = 'Connected to GitHub';
                        statusBar.style.color = 'inherit';
                    }, 3000);
                } else {
                    statusBar.textContent = 'Error: ' + result.message;
                    statusBar.style.color = '#f87171';
                }
            } catch (e) {
                statusBar.textContent = 'Network Error';
                statusBar.style.color = '#f87171';
            }
        }
    </script>
</body>

</html>